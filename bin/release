#!/usr/bin/env php
<?php
declare(strict_types=1);

use Symfony\Component\Config\FileLocator;
use Symfony\Component\Console\Application;
use Symfony\Component\Console\Command\Command;
use Symfony\Component\Console\DependencyInjection\AddConsoleCommandPass;
use Symfony\Component\DependencyInjection\ContainerBuilder;
use Symfony\Component\DependencyInjection\Loader\YamlFileLoader;

foreach ([__DIR__ . '/../../../autoload.php', __DIR__ . '/../vendor/autoload.php'] as $file) {
    if (file_exists($file)) {
        require $file;
        break;
    }
}

$container = new ContainerBuilder();

$loader = new YamlFileLoader($container, new FileLocator(__DIR__ . '/../config'));
$loader->load('services.yaml');
$loader->load('commands.yaml');

$container->addCompilerPass(new AddConsoleCommandPass);
$container->compile();

$application = new Application('Leviy Release Tool');

/** @var string[] $commandIds */
$commandIds = $container->getParameter('console.command.ids');

foreach ($commandIds as $commandId) {
    /** @var Command $command */
    $command = $container->get($commandId);

    $application->add($command);
}

$application->run();
